webpackJsonp([1],{163:function(e,t,r){"use strict";var n=(r(327),r(105)),o=r.n(n),a=r(329),i=(r.n(a),r(443)),s=r.n(i);r.d(t,"b",function(){return c}),r.d(t,"a",function(){return p}),r.d(t,"c",function(){return f});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){return Promise.resolve()},p=function(e){var t=e.apiRoot,r=e.formId;return Promise.all([o()(t+"/forms/api/v1/forms/"+r+"/jsonschema"),o()(t+"/forms/api/v1/forms/"+r+"/ui")]).then(function(e){return Promise.all(e.map(function(e){return e.ok?e.json().then(function(e){return e}):Promise.reject("Can't receive form schema from "+e.url)}))}).then(function(e){var r=m(e,2),n=r[0],a=r[1];if(!("datasource_fields"in n))return Promise.resolve({schema:n,uiSchema:a});var i=n.datasource_fields;return Promise.all(i.map(function(e){var r=e.id,n=e.property;return o()(t+"/forms/api/v1/datasource/"+r+"/feed").then(function(e){return e.ok?e.json().then(function(e){return{property:n,data:e}}):Promise.reject("Can't receive datasource from "+e.url)})})).then(function(e){return{datasources:e,schema:n,uiSchema:a}})}).then(function(e){var t=e.datasources,r=e.schema,n=e.uiSchema;return"datasources"in e?(t.map(function(e){var t=e.property,n=e.data;"items"in r.properties[t]?(delete r.properties[t].items.enum,delete r.properties[t].items.enumNames,r.properties[t].items.enum=s.a.map(s.a.prop("id"),n),r.properties[t].items.enumNames=s.a.map(s.a.prop("name"),n)):(delete r.properties[t].enum,delete r.properties[t].enumNames,r.properties[t].enum=s.a.map(s.a.prop("id"),n),r.properties[t].enumNames=s.a.map(s.a.prop("name"),n))}),{schema:{schema:r,uiSchema:n}}):{schema:{schema:r,uiSchema:n}}})},f=function(e){return e.map(function(e){var t=u({},e);if("minLength"===t.name){var r=t.schema.title,n=t.argument;t.message='Минимальная длина поля "'+r+'" - '+n+" символа"}if("maxLength"===t.name){var o=t.schema.title,a=t.argument;t.message='Максимальная длина поля "'+o+'" - '+a+" символов"}if("format"===t.name){var i=t.schema.title,s=t.argument;t.message='Поле "'+i+'" не соответствует формату '+s}if("required"===t.name){var m=t.schema,c=t.argument,p=m.properties[c].title;t.message='Обязательное поле: "'+p+'"'}if("pattern"===t.name){var f=t.schema.title,l=t.argument;t.message='Поле "'+f+'" не соответствует формату '+l}return t})}},291:function(e,t,r){"use strict";function n(e){var t=e.formId,n=e.onSubmit,o=e.onError,u=e.apiRoot,m=e.enumItems,c=e.dataProcessor,p=void 0===c?function(e){return e}:c,f=e.rootId,l=void 0===f?"defaultFormId":f,h=document.getElementById(l);h&&t&&r.i(i.render)(a.a.createElement(s.a,{formId:t,enumItems:m,onSubmit:n,onError:o,apiRoot:u,dataProcessor:p}),h)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=r.n(o),i=r(638),s=(r.n(i),r(328));window.schemaFormViewer={init:n,Component:s.a}},325:function(e,t,r){"use strict";function n(e){var t=e.formData,r=e.uiSchema,n=r.formMetaData,o=r.onSubmit,a=r.onError,i=r.formId,s=r.dataProcessor,u=n.submitUrl,m=n.submitMethod,c=void 0===m?"POST":m;console.log("submit to API:",u,"formId",i),l()(u,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(s(d({},t)))}).then(o).catch(a)}function o(e){var t=e.schema,r=e.uiSchema,n=e.enumItems,o=t;return p()(r,function(e,t){if("externalEnum"in e){var r=e.externalEnum;n&&n[r]&&(o.properties[t].enum=n[r])}}),o}var a=r(4),i=r.n(a),s=r(323),u=r.n(s),m=r(188),c=(r.n(m),r(424)),p=r.n(c),f=r(105),l=r.n(f),h=r(163),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v=function(e){var t=e.schemaData,r=t.schema,a=r.schema,s=r.uiSchema,m=t.onSubmit,c=t.onError,p=t.dataProcessor,f=e.enumItems,l=s.formMetaData,v=l.submitMethod,b=void 0===v?"POST":v,y=l.buttonLabel,P=void 0===y?"Отправить":y,S=l.buttonClasses,g=void 0===S?"btn btn-primary":S,I=l.submitUrl;o({schema:a,uiSchema:s,enumItems:f});return console.log("Form jsonschema",a,"uiSchema",s),i.a.createElement(u.a,{action:I,method:b,schema:a,uiSchema:d({},s,{onSubmit:m,onError:c,dataProcessor:p}),showErrorList:!1,onSubmit:n,transformErrors:h.c,noHtml5Validate:!0,validateOnBlur:!0},i.a.createElement("button",{className:g,type:"submit"},P))};v.propTypes={schemaData:a.PropTypes.object.isRequired,enumItems:a.PropTypes.object},v.defaultProps={enumItems:[]},t.a=v},326:function(e,t,r){"use strict";var n=r(4),o=r.n(n),a=r(188),i=r.n(a),s=r(325),u=function(e){var t=e.schemaData,r=e.enumItems;return t&&i()(t)?o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-xs-12"},o.a.createElement(s.a,{schemaData:t,enumItems:r}))):null};u.propTypes={schemaData:n.PropTypes.object.isRequired,enumItems:n.PropTypes.object},u.defaultProps={enumItems:[]},t.a=u},327:function(e,t,r){"use strict";var n=r(704),o=(r.n(n),r(439));r.n(o)},328:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=r(4),s=r.n(i),u=r(326),m=r(163),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(e){function t(){var e,r,a,i;n(this,t);for(var s=arguments.length,u=Array(s),m=0;m<s;m++)u[m]=arguments[m];return r=a=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),a.state={schema:void 0},a.saveSchema=function(e){if("object"===(void 0===e?"undefined":p(e))){var t=a.props,r=t.formId,n=t.onSubmit,o=t.onError,i=t.apiRoot,s=t.dataProcessor,u=c({},e);"schema"in e&&(u.schema.uiSchema.formMetaData.submitUrl=i+"/forms/api/v1/data/"+r,a.setState({schema:c({},u,{onSubmit:n,onError:o,dataProcessor:s})}))}},i=r,o(a,i)}return a(t,e),f(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.apiRoot,n=e.formId;r.i(m.a)({formId:n,apiRoot:t}).then(this.saveSchema).catch(this.saveSchema)}},{key:"render",value:function(){var e=this.state.schema;if(!e)return null;if("object"===(void 0===e?"undefined":p(e))&&"schema"in e){var t=this.props.enumItems;return s.a.createElement(u.a,{schemaData:e,enumItems:t})}return s.a.createElement("div",{className:"form-service-error"},e)}}]),t}(s.a.Component);l.propTypes={formId:i.PropTypes.string.isRequired,apiRoot:i.PropTypes.string.isRequired,enumItems:i.PropTypes.object,onSubmit:i.PropTypes.func,onError:i.PropTypes.func,dataProcessor:i.PropTypes.func},l.defaultProps={onSubmit:m.b,onError:m.b,dataProcessor:m.b,enumItems:[]},t.a=l},752:function(e,t,r){e.exports=r(291)}},[752]);